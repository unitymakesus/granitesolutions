"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var i=[],a=!0,r=!1,s=void 0;try{for(var n,o=e[Symbol.iterator]();!(a=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){r=!0,s=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw s}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var MatadorTraffic=function(){function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"{}";_classCallCheck(this,i),this.domain=e,this.options=JSON.parse(t),this.referrer=document.referrer,this.defaults={host:this.domain,cookieName:"matador_visitor",separator:".",expires:1728e5,labels:{none:"direct(none)",social:"social",referral:"referral",organic:"organic"},queryParams:{campaign:"utm_campaign",source:"utm_source",medium:"utm_medium",term:"utm_term",content:"utm_content"},socialNetworks:{facebook:["/(.+?).facebook./","/(.+?).fb.me/"],linkedin:["/(.+?).linkedin./"],twitter:["/(.+?).twitter./","/(.+?).t.co/"],reddit:["/(.+?).reddit./"],instagram:["/(.+?).instagram./"],youtube:["/(.+?).youtube./"]},searchEngines:{google:["/(.+?).google./"],bing:["/(.+?).bing./"],yahoo:["/(.+?).yahoo./"],aol:["/(.+?).aol./"],baidu:["/(.+?).baidu./"],duckduckgo:["/(.+?).duckduckgo./"]}},this.options=Object.assign(this.defaults,this.options),this.campaign={timestamp:"",sessions:1,campaigns:0,campaign:"",medium:"",source:"",term:"",content:""},this.initialize()}return _createClass(i,[{key:"initialize",value:function(){var e;this.hasReferrer()&&(this.hasCookie(this.options.cookieName)?(e=this.getCookie(this.options.cookieName),this.parseMatadorCookie(e)):this.hasCookie("__utmz")&&(e=this.getCookie("__utmz"),this.parseUTMZCookie(e)),this.query.campaign?this.query.campaign===this.campaign.campaign?this.campaign.sessions++:(this.campaign.campaign=this.query.campaign,this.query.source&&this.query.source!==this.campaign.source?this.campaign.source=this.query.source:this.campaign.source="",this.query.medium&&this.query.medium!==this.campaign.medium?this.campaign.medium=this.query.medium:this.campaign.medium="",this.query.content&&this.query.content!==this.campaign.content?this.campaign.content=this.query.content:this.campaign.content="",this.query.term&&this.query.term!==this.campaign.term?this.campaign.term=this.query.term:this.campaign.term="",this.campaign.sessions=1,this.campaign.campaigns++):this.referrer?this.campaign.source===i.removeProtocol(this.referrer)?this.campaign.sessions++:(this.campaign.campaign="",this.campaign.source=i.removeProtocol(this.referrer),this.referrerIsA(this.options.socialNetworks)?(this.campaign.source=this.referrerIsA(this.options.socialNetworks),this.campaign.medium=this.options.labels.social):this.referrerIsA(this.options.searchEngines)?(this.campaign.source=this.referrerIsA(this.options.searchEngines),this.campaign.medium=this.options.labels.organic):this.campaign.medium=this.options.labels.referral,this.campaign.term="",this.campaign.content="",this.campaign.sessions=1,this.campaign.campaigns++):this.campaign.source===this.options.labels.none?this.campaign.sessions++:(this.campaign.source=this.options.labels.none,this.campaign.campaign="",this.campaign.medium="",this.campaign.term="",this.campaign.content="",this.campaign.sessions=1,this.campaign.campaigns++),this.setCookie())}},{key:"queryParameter",value:function(e){var t,i,a=!0,r=!1,s=void 0;try{for(var n,o=window.location.search.substring(1).split("&")[Symbol.iterator]();!(a=(n=o.next()).done);a=!0){var c=_slicedToArray(n.value.split("="),2);t=c[0];var m=c[1];if(i=void 0===m?"":m,t===e)break;i=""}}catch(e){r=!0,s=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw s}}return i}},{key:"hasCookie",value:function(e){return!(-1===document.cookie.indexOf(e))}},{key:"getCookie",value:function(e){var t,i,a=!0,r=!1,s=void 0;try{for(var n,o=document.cookie.split("; ")[Symbol.iterator]();!(a=(n=o.next()).done);a=!0){var c=_slicedToArray(n.value.split(/=(.+)/),2);t=c[0];var m=c[1];if(i=void 0===m?"":m,t===e)return i}}catch(e){r=!0,s=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw s}}return null}},{key:"setCookie",value:function(){var e,t,i,a=new Date,r=this.campaign,s=this.options;for(e in r.timestamp=Math.floor(a.getTime()/1e3),a.setTime(a.getTime()+s.expires),i="".concat(r.timestamp).concat(s.separator).concat(r.sessions).concat(s.separator).concat(r.campaigns),delete r.timestamp,delete r.sessions,delete r.campaigns,t="",r)r[e]&&(t+=t?"|":"",t+="".concat(e,"=").concat(r[e]));i+="".concat(s.separator).concat(t),document.cookie=s.cookieName+"="+i.replace(/ /g,"_")+"; expires="+a.toUTCString()+"; domain="+this.domain+"; path=/; samesite=strict; "}},{key:"hasReferrer",value:function(){return this.referrer.split("/")[2]!==location.hostname}},{key:"referrerIsA",value:function(e){var t,i,a,r=0<arguments.length&&void 0!==e?e:{},s="";if(0===Object.keys(r).length&&r.constructor===Object)return!1;for(i in r){var n=!0,o=!1,c=void 0;try{for(var m,u=r[i][Symbol.iterator]();!(n=(m=u.next()).done);n=!0)if(a=m.value,t=new RegExp(a.slice(1,-1)),this.referrer.match(t)){s=i;break}}catch(e){o=!0,c=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw c}}if(s)break}return s}},{key:"parseMatadorCookie",value:function(e){var t,i;t=e.split(".",4),this.campaign.timestamp=t[0],this.campaign.sessions=parseInt(t[1],10),this.campaign.campaigns=parseInt(t[2],10);var a=!0,r=!1,s=void 0;try{for(var n,o=t[3].split("|")[Symbol.iterator]();!(a=(n=o.next()).done);a=!0)i=n.value.split("="),this.campaign[i[0]]=i[1]}catch(e){r=!0,s=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw s}}}},{key:"parseUTMZCookie",value:function(e){var t,i,a;t={utmccn:"campaign",utmcmd:"medium",utmcsr:"source",utmctr:"term",utmcct:"content"},i=e.split(".",5),this.campaign.timestamp=i[1],this.campaign.sessions=parseInt(i[2],10),this.campaign.campaigns=parseInt(i[3]);var r=!0,s=!1,n=void 0;try{for(var o,c=i[4].split("|")[Symbol.iterator]();!(r=(o=c.next()).done);r=!0)a=o.value.split("="),this.campaign[t[a[0]]]=a[1]}catch(e){s=!0,n=e}finally{try{r||null==c.return||c.return()}finally{if(s)throw n}}}},{key:"query",get:function(){var e={};return e.campaign=this.queryParameter(this.options.queryParams.campaign),e.source=this.queryParameter(this.options.queryParams.source),e.medium=this.queryParameter(this.options.queryParams.medium),e.term=this.queryParameter(this.options.queryParams.term),e.content=this.queryParameter(this.options.queryParams.content),e}}],[{key:"removeProtocol",value:function(e){return e.replace(/.*?:\/\//g,"")}}]),i}();